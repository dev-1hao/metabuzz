<template>
  <div
    class="action-btn like-btn"
    :class="{ liked: isLiked }"
    @click.stop="likeSubmit"
  >
    <i class="svg-icon liked" v-if="isLiked">
      <svg
        class="bi bi-heart-fill"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="3410"
        width="200"
        height="200"
      >
        <path
          d="M890.53 410.23l-0.74-1.01C865.26 375.89 828.1 356 787.44 356H648.2l0.05-0.43c4.59-20.42 7.72-41.24 9.21-61.63 3.86-52.75-3.46-101.02-22.57-139.51-24.09-48.49-65.77-79.51-119-88.68l-1.62-0.27c-27.36-4.47-53.32 0.9-75.17 19.07-12.26 10.2-21.48 22.82-28.31 37.58-5.03 10.88-8.76 22.83-11.88 36.97l-0.35 1.59-0.49 2.3c-0.62 2.99-1.22 6.1-1.81 9.34l-0.29 1.62-0.45 2.56-0.24 1.4-0.27 1.61-0.44 2.68-0.26 1.63-0.54 3.52-0.14 0.91-0.44 3.02-0.44 3.08-0.65 4.73-0.43 3.23-0.43 3.3-0.43 3.37-0.42 3.44-0.42 3.51-0.38 3.2-4.12 34.11-3.15 21.18-0.3 1.79-0.41 2.35-0.21 1.16-0.17 0.95-0.46 2.46c-0.14 0.74-0.28 1.48-0.42 2.21l-0.43 2.17c-0.07 0.36-0.14 0.71-0.22 1.07l-0.44 2.11c-0.15 0.7-0.29 1.39-0.44 2.07l-0.45 2.03c-0.15 0.67-0.3 1.33-0.46 1.99l-0.46 1.96-0.47 1.92-0.47 1.88c-0.56 2.18-1.13 4.28-1.71 6.32l-0.51 1.73c-3.14 10.57-6.71 19.32-10.85 26.96-7.02 12.92-15.01 21.39-24.97 27.03-11.9 6.74-28.52 10.61-51.58 10.29h-68.66c-36.41 0-58.42 14.16-82.53 39.19-28.85 29.95-29.7 81.18-29.7 81.18v344.6c0 30.27 10.51 59.12 29.52 81.26 20.69 24.1 50.3 38.88 82.57 38.88h500.49c30.08 0 59.18-11.27 82.15-31.26 22.82-19.86 38.63-47.48 45.08-77.74l68.86-323.23c8.75-41.07 0.12-83.92-24.14-117.53z"
          fill="#24B898"
          opacity=".7"
          p-id="3411"
        ></path>
        <path
          d="M890.53 410.23l-0.74-1.01C865.26 375.89 828.1 356 787.44 356H648.2l0.05-0.43c4.59-20.42 7.72-41.24 9.21-61.63 3.86-52.75-3.46-101.02-22.57-139.51-24.09-48.49-65.77-79.51-119-88.68l-1.62-0.27c-27.36-4.47-53.32 0.9-75.17 19.07-12.26 10.2-21.48 22.82-28.31 37.58-5.03 10.88-8.76 22.83-11.88 36.97l-0.35 1.59-0.49 2.3c-0.62 2.99-1.22 6.1-1.81 9.34l-0.29 1.62-0.45 2.56-0.24 1.4-0.27 1.61-0.44 2.68-0.26 1.63-0.54 3.52-0.14 0.91-0.44 3.02-0.44 3.08-0.65 4.73-0.43 3.23-0.43 3.3-0.43 3.37-0.42 3.44-0.42 3.51-0.38 3.2-4.12 34.11-3.15 21.18-0.3 1.79-0.41 2.35-0.21 1.16-0.17 0.95-0.46 2.46c-0.14 0.74-0.28 1.48-0.42 2.21l-0.43 2.17c-0.07 0.36-0.14 0.71-0.22 1.07l-0.44 2.11c-0.15 0.7-0.29 1.39-0.44 2.07l-0.45 2.03c-0.15 0.67-0.3 1.33-0.46 1.99l-0.46 1.96-0.47 1.92-0.47 1.88c-0.56 2.18-1.13 4.28-1.71 6.32l-0.51 1.73c-3.14 10.57-6.71 19.32-10.85 26.96-7.02 12.92-15.01 21.39-24.97 27.03-11.9 6.74-28.52 10.61-51.58 10.29h-68.66c-36.41 0-58.42 14.16-82.53 39.19-28.85 29.95-29.7 81.18-29.7 81.18v344.6c0 30.27 10.51 59.12 29.52 81.26 20.69 24.1 50.3 38.88 82.57 38.88h500.49c30.08 0 59.18-11.27 82.15-31.26 22.82-19.86 38.63-47.48 45.08-77.74l68.86-323.23c8.75-41.07 0.12-83.92-24.14-117.53zM218.06 889.07c-21.71 0-41.1-21.28-41.1-49.19V495.25s-0.1-49.48 41.31-49.48H256v443.3h-37.94z m627.23-376.1l-68.87 323.28c-3.32 15.6-11.36 29.51-22.27 39.01-10.31 8.97-22.96 13.81-35.53 13.81H320V443.62c51.56-7.35 84.64-33.24 105.83-72.22 11.51-21.17 19.07-45.22 24.71-75.12l0.49-2.65c0.16-0.89 0.32-1.78 0.48-2.68l0.47-2.72c0.16-0.91 0.31-1.83 0.47-2.75l3.39-22.76 4.24-35.08 0.4-3.41 0.4-3.32 0.4-3.24 0.4-3.16 0.4-3.07 0.5-3.73 0.5-3.6 0.4-2.79 0.4-2.72 0.2-1.33 0.4-2.6 0.2-1.27 0.41-2.49c0.14-0.82 0.27-1.63 0.41-2.42l0.41-2.35c0.55-3.09 1.1-5.99 1.67-8.72l0.43-2.01 0.32-1.46 0.32-1.42 0.33-1.39 0.33-1.35 0.33-1.32 0.33-1.29c0.06-0.21 0.11-0.42 0.17-0.63l0.34-1.24 0.34-1.21 0.35-1.18c0.06-0.19 0.12-0.39 0.17-0.58l0.35-1.13 0.35-1.1 0.18-0.54 0.36-1.06c0.24-0.69 0.49-1.37 0.73-2.03l0.37-0.97c0.06-0.16 0.13-0.32 0.19-0.48l0.38-0.93c0.45-1.07 0.9-2.08 1.37-3.05l0.4-0.81c0.67-1.34 1.37-2.57 2.09-3.71l0.43-0.67c0.29-0.44 0.59-0.87 0.89-1.29l0.45-0.61c0.38-0.5 0.77-0.98 1.16-1.44l0.47-0.54c0.96-1.07 1.95-2.03 2.99-2.89 4.49-3.74 9.67-5.01 18.34-3.59 31.47 5.13 54.34 22 68.49 50.48 12.77 25.71 18.38 61.36 15.35 102.8-2.02 27.64-7.73 56.51-16.41 83.06-7.18 21.98 4.83 45.62 26.82 52.8 4.2 1.37 13 2.3 13 2.3H787.5c17.47 0 33.92 8.73 45.53 24.81 12.35 17.09 16.91 39.44 12.26 61.22z"
          fill="#24B898"
          p-id="3412"
        ></path>
      </svg>
    </i>
    <i class="svg-icon" v-else>
      <svg
        t="1604480227200"
        class="bi bi-heart"
        fill="currentColor"
        viewBox="0 0 1024 1024"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        p-id="1793"
        width="1em"
        height="1em"
      >
        <path
          fill-rule="evenodd"
          d="M890.53 410.23l-0.74-1.01C865.26 375.89 828.1 356 787.44 356H648.2l0.05-0.43c4.59-20.42 7.72-41.24 9.21-61.63 3.86-52.75-3.46-101.02-22.57-139.51-24.09-48.49-65.77-79.51-119-88.68l-1.62-0.27c-27.36-4.47-53.32 0.9-75.17 19.07-12.26 10.2-21.48 22.82-28.31 37.58-5.03 10.88-8.76 22.83-11.88 36.97l-0.35 1.59-0.49 2.3c-0.62 2.99-1.22 6.1-1.81 9.34l-0.29 1.62-0.45 2.56-0.24 1.4-0.27 1.61-0.44 2.68-0.26 1.63-0.54 3.52-0.14 0.91-0.44 3.02-0.44 3.08-0.65 4.73-0.43 3.23-0.43 3.3-0.43 3.37-0.42 3.44-0.42 3.51-0.38 3.2-4.12 34.11-3.15 21.18-0.3 1.79-0.41 2.35-0.21 1.16-0.17 0.95-0.46 2.46c-0.14 0.74-0.28 1.48-0.42 2.21l-0.43 2.17c-0.07 0.36-0.14 0.71-0.22 1.07l-0.44 2.11c-0.15 0.7-0.29 1.39-0.44 2.07l-0.45 2.03c-0.15 0.67-0.3 1.33-0.46 1.99l-0.46 1.96-0.47 1.92-0.47 1.88c-0.56 2.18-1.13 4.28-1.71 6.32l-0.51 1.73c-3.14 10.57-6.71 19.32-10.85 26.96-7.02 12.92-15.01 21.39-24.97 27.03-11.9 6.74-28.52 10.61-51.58 10.29h-68.66c-36.41 0-58.42 14.16-82.53 39.19-28.85 29.95-29.7 81.18-29.7 81.18v344.6c0 30.27 10.51 59.12 29.52 81.26 20.69 24.1 50.3 38.88 82.57 38.88h500.49c30.08 0 59.18-11.27 82.15-31.26 22.82-19.86 38.63-47.48 45.08-77.74l68.86-323.23c8.75-41.07 0.12-83.92-24.14-117.53zM218.06 889.07c-21.71 0-41.1-21.28-41.1-49.19V495.25s-0.1-49.48 41.31-49.48H256v443.3h-37.94z m627.23-376.1l-68.87 323.28c-3.32 15.6-11.36 29.51-22.27 39.01-10.31 8.97-22.96 13.81-35.53 13.81H320V443.62c51.56-7.35 84.64-33.24 105.83-72.22 11.51-21.17 19.07-45.22 24.71-75.12l0.49-2.65c0.16-0.89 0.32-1.78 0.48-2.68l0.47-2.72c0.16-0.91 0.31-1.83 0.47-2.75l3.39-22.76 4.24-35.08 0.4-3.41 0.4-3.32 0.4-3.24 0.4-3.16 0.4-3.07 0.5-3.73 0.5-3.6 0.4-2.79 0.4-2.72 0.2-1.33 0.4-2.6 0.2-1.27 0.41-2.49c0.14-0.82 0.27-1.63 0.41-2.42l0.41-2.35c0.55-3.09 1.1-5.99 1.67-8.72l0.43-2.01 0.32-1.46 0.32-1.42 0.33-1.39 0.33-1.35 0.33-1.32 0.33-1.29c0.06-0.21 0.11-0.42 0.17-0.63l0.34-1.24 0.34-1.21 0.35-1.18c0.06-0.19 0.12-0.39 0.17-0.58l0.35-1.13 0.35-1.1 0.18-0.54 0.36-1.06c0.24-0.69 0.49-1.37 0.73-2.03l0.37-0.97c0.06-0.16 0.13-0.32 0.19-0.48l0.38-0.93c0.45-1.07 0.9-2.08 1.37-3.05l0.4-0.81c0.67-1.34 1.37-2.57 2.09-3.71l0.43-0.67c0.29-0.44 0.59-0.87 0.89-1.29l0.45-0.61c0.38-0.5 0.77-0.98 1.16-1.44l0.47-0.54c0.96-1.07 1.95-2.03 2.99-2.89 4.49-3.74 9.67-5.01 18.34-3.59 31.47 5.13 54.34 22 68.49 50.48 12.77 25.71 18.38 61.36 15.35 102.8-2.02 27.64-7.73 56.51-16.41 83.06-7.18 21.98 4.83 45.62 26.82 52.8 4.2 1.37 13 2.3 13 2.3H787.5c17.47 0 33.92 8.73 45.53 24.81 12.35 17.09 16.91 39.44 12.26 61.22z"
          p-id="1794"
        ></path>
      </svg>
    </i>
    <span class="label-text">{{ text }}</span>
  </div>
</template>

<script lang="ts">
import { Component, Vue, Prop } from 'vue-property-decorator'
import { Getter } from 'vuex-class'
import { MetaIdDataTypes, UserInfoTypes } from '@/@types/metaid-types.d.ts'
import { goAuth } from '@/api/metasv-buzz'

interface BuzzTypes extends MetaIdDataTypes {
  likes?: MetaIdDataTypes[];
  comments?: MetaIdDataTypes[];
  userInfo?: UserInfoTypes;
}
@Component({
  components: {
  },
})
export default class LoginButton extends Vue {
  @Prop({
    type: Object,
  })
  item: BuzzTypes
  @Prop({
    type: Function,
  })
  callback: Function
  @Prop({
    type: [String, Number],
  })
  text: string | number

  @Getter('isLogined') isLogined: boolean
  @Getter('accessToken') accessToken: string
  @Getter('userInfo') userInfo: UserInfoTypes
  get isLiked() {
    return this.item.likes.find(obj => obj.rootTxId === this.userInfo.metaId)
  }

  likeSubmit() {
    if (!this.isLogined) {
      return this.$confirm(
        {
          message: `Please sign in?`,
          button: {
            no: 'Cancel',
            yes: 'Sign in'
          },
          callback: confirm => {
            if (confirm) {
              goAuth()
            }
          }
        }
      )
    }
    if (this.isLiked) return
    const payLikeParams = {
      nodeName: 'PayLike',
      metaIdTag: this.AppConfig.metaIdTag,
      brfcId: '5c7afdb85de5',
      accessToken: this.accessToken,
      payCurrency: 'usd',
      payTo: [
        { amount: this.AppConfig.env === 'prod' ? 0.02 : 0.0001, address: this.item.userInfo.address },
        { amount: this.AppConfig.env === 'prod' ? 0.005 : 0.0001, address: '12tfZ62i9GesyYWCA3nZuibFJCGsmxKyF2' },
      ],
      dataType: 'applicaition/json',
      path: '/Protocols/PayLike',
      data: JSON.stringify({
        createTime: new Date().getTime(),
        isLike: '1',
        likeTo: this.item.txId,
        pay: this.AppConfig.env === 'prod' ? '10000' : '600',
        payTo: this.item.userInfo.address
      }),
      callback: this.handleLike
    }
    this.$metaidjs.sendMetaDataTx(payLikeParams)
  }
  handleLike(res) {
    if (typeof this.callback === 'function') {
      this.callback(res)
    }
  }
}
</script>

<style lang="scss">
.action-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  &.liked {
    color: #24b898;
  }
  i,
  span {
    display: inline-block;
    margin-right: 8px;
  }
  i svg {
    width: 18px;
    height: 18px;
  }
}
</style>
